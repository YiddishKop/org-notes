<p>
Today’s tip is one I <a href="https://github.com/magnars/expand-region.el/issues/159#issuecomment-83538021">learned from Magnar</a>. A lot of Emacsers don’t know this, but
most commands that move point large distances (like <code>isearch</code> or
<code>end-of-buffer</code>) push the old position to the <a href="http://doc.endlessparentheses.com/Var/mark-ring"><code>mark-ring</code></a>. The advantage is that
you can easily jump back through this history of positions by hitting <kbd>C-u
C-SPC</kbd>.
</p>

<p>
This is a hugely convenient take-me-back-to-that-last-place command. The only
problem is that sometimes the ring gets filled with repeated entries, so you
find yourself hitting <kbd>C-u C-SPC</kbd> 2 to 4 times in the same place. Of course,
this is Emacs, so all it takes to solve our problem is one simple advice.
</p>
<figure class="highlight"><pre><code class="language-cl" data-lang="cl"><span class="c1">;; When popping the mark, continue popping until the cursor</span>
<span class="c1">;; actually moves</span>
<span class="p">(</span><span class="nv">defadvice</span> <span class="nv">pop-to-mark-command</span>
    <span class="p">(</span><span class="nv">around</span> <span class="nv">ensure-new-position</span> <span class="nv">activate</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">p</span> <span class="p">(</span><span class="nv">point</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">dotimes</span> <span class="p">(</span><span class="nv">i</span> <span class="mi">10</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">=</span> <span class="nv">p</span> <span class="p">(</span><span class="nv">point</span><span class="p">))</span>
        <span class="nv">ad-do-it</span><span class="p">))))</span></code></pre></figure>

<p>
Finally, a simple <code>setq</code> ensures we can quickly pop the mark several times by
typing <kbd>C-u C-SPC C-SPC</kbd>, instead of having to type <kbd>C-u C-SPC C-u C-SPC</kbd>.
</p>
<figure class="highlight"><pre><code class="language-cl" data-lang="cl"><span class="p">(</span><span class="k">setq</span> <span class="nv">set-mark-command-repeat-pop</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1">Update <span class="timestamp-wrapper"><span class="timestamp">20 Jan 2016</span></span></h2>
<div class="outline-text-2" id="text-orgheadline1">
<p>
Kaushal Modi <a href="https://github.com/kaushalmodi/.emacs.d/blob/f2be887c9454b769fdd1236fc911bcfc5679d7d1/setup-files/setup-editing.el#L746-L753">provides us</a> with how this advice would look using the new
<code>advice-add</code> interface.
</p>
<figure class="highlight"><pre><code class="language-cl" data-lang="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">modi/multi-pop-to-mark</span> <span class="p">(</span><span class="nv">orig-fun</span> <span class="k">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
  <span class="s">"Call ORIG-FUN until the cursor moves.
Try the repeated popping up to 10 times."</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">p</span> <span class="p">(</span><span class="nv">point</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">dotimes</span> <span class="p">(</span><span class="nv">i</span> <span class="mi">10</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">=</span> <span class="nv">p</span> <span class="p">(</span><span class="nv">point</span><span class="p">))</span>
        <span class="p">(</span><span class="nb">apply</span> <span class="nv">orig-fun</span> <span class="nv">args</span><span class="p">)))))</span>
<span class="p">(</span><span class="nv">advice-add</span> <span class="ss">'pop-to-mark-command</span> <span class="ss">:around</span>
            <span class="nf">#'</span><span class="nv">modi/multi-pop-to-mark</span><span class="p">)</span></code></pre></figure>
</div>
</div>

   <p><a href="http://endlessparentheses.com/faster-pop-to-mark-command.html?source=rss#disqus_thread">Comment on this.</a></p>
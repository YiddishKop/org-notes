<p>
<a href="http://doc.endlessparentheses.com/Fun/fill-paragraph"><code>fill-paragraph</code></a> is probably among the most underappreciated Emacs commands. I
use it dozens of times a day, and never stop to think of just how awesome and
practical it is. Still, we can make it a little bit better. Every once in a
while I need to “unfill” (or “unwrap”) a paragraph that’s broken over many
lines.
</p>

<p>
By being clever enough, we can make this into a <a href="/hungry-delete-mode.html">free feature</a>. There’s never any
reason to hit <kbd>M-q</kbd> twice on the same paragraph, so we can use that as our
keybind for the “unfill” command.
</p>
<figure class="highlight"><pre><code class="language-cl" data-lang="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">endless/fill-or-unfill</span> <span class="p">()</span>
  <span class="s">"Like `fill-paragraph', but unfill if used twice."</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">fill-column</span>
         <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">eq</span> <span class="nv">last-command</span> <span class="ss">'endless/fill-or-unfill</span><span class="p">)</span>
             <span class="p">(</span><span class="k">progn</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">this-command</span> <span class="no">nil</span><span class="p">)</span>
                    <span class="p">(</span><span class="nv">point-max</span><span class="p">))</span>
           <span class="nv">fill-column</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">call-interactively</span> <span class="nf">#'</span><span class="nv">fill-paragraph</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">global-set-key</span> <span class="nv">[remap</span> <span class="nv">fill-paragraph]</span>
                <span class="nf">#'</span><span class="nv">endless/fill-or-unfill</span><span class="p">)</span></code></pre></figure>

<p>
With this, <kbd>M-q</kbd> will act as a toggle. Hitting it once will do its usual thing
(even if the paragraph is already filled), but hitting it twice will completely
unwrap the current paragraph into a single line.
</p>

   <p><a href="http://endlessparentheses.com/fill-and-unfill-paragraphs-with-a-single-key.html?source=rss#disqus_thread">Comment on this.</a></p>
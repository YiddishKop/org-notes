<p>
The <a href="http://emacs.stackexchange.com/">emacs.stackexchange</a> beta has only just started and interesting
topics have already begun to pop up. Partially to share snippets I
find nifty, and partially to help promote the beta, I’ll be posting
here questions and answers I find engaging. 
</p>

<p>
I’m kicking off this series with a <a href="http://emacs.stackexchange.com/q/140/50">question of my own</a>, answered by none
other than <a href="http://emacs.stackexchange.com/a/150/50">Sebastian Wiesner</a>. (Did you know he <a href="http://www.lunaryorn.com/">has a blog</a>)? The beta
is still private, so you might not be able to visit the links above,
but I’ll summ it up here.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Question</h2>
<div class="outline-text-2" id="text-1">
<p>
For a while now I’ve noticed my dired patterns are somewhat
predictable. 
</p>

<ul class="org-ul">
<li>Whenever I visit the directory of one of my papers, I go straight to
the <i>“master.tex”</i> file.
</li>
<li>When I open the root of an android project, it’s almost always to
visit the the <i>“AndroidManifest.xml”</i>.
</li>
<li>Finally, when I go to a directory where I’m developing an emacs
package, 80% of the time I’m headed for the package's main source
file.
</li>
</ul>

<p>
See the pattern? For all these directories, the first file I visit is
very predictable, so I wanted dired to focus that file automatically
for me. So I would only need to hit <kbd>RET</kbd>&#x2014;lazyness
to the extreme.
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Solution</h2>
<div class="outline-text-2" id="text-2">
<p>
Sebastian looks into the <code>save-place</code> package’s source code, and finds
out about <a href="http://doc.endlessparentheses.com/Var/dired-initial-position-hook"><code>dired-initial-position-hook</code></a>, which is run exactly when we
need. Visiting a file whose name we already know is then a trivial
matter.<br  />
<i>Note I’ve edited his code a bit.</i>
</p>
<figure class="highlight"><pre><code class="language-cl" data-lang="cl"><span class="p">(</span><span class="nv">defcustom</span> <span class="nv">endless/important-files</span> 
  <span class="o">'</span><span class="p">(</span><span class="s">"master.tex"</span> <span class="s">"AndroidManifest.xml"</span> <span class="s">"init.org"</span><span class="p">)</span>
  <span class="s">"List of files which dired should focus by default."</span>
  <span class="ss">:type</span> <span class="o">'</span><span class="p">(</span><span class="nv">repeat</span> <span class="nb">string</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">my-dired-goto-important-file</span> <span class="p">()</span>
  <span class="s">"Go to an important file in the current dired buffer."</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">candidates</span> <span class="nv">endless/important-files</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">matched</span> <span class="no">nil</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">candidates</span> <span class="p">(</span><span class="nb">null</span> <span class="nv">matched</span><span class="p">))</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">matched</span> <span class="p">(</span><span class="nv">dired-goto-file</span>
                     <span class="p">(</span><span class="nv">expand-file-name</span> <span class="p">(</span><span class="nb">pop</span> <span class="nv">candidates</span><span class="p">)))))</span>
    <span class="p">(</span><span class="nb">unless</span> <span class="nv">matched</span>
      <span class="p">(</span><span class="nv">endless/goto-elisp-file</span><span class="p">))))</span>

<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'dired-initial-position-hook</span>
          <span class="c1">;; Append so we run after `save-place'</span>
          <span class="nf">#'</span><span class="nv">my-dired-goto-important-file</span> <span class="ss">'append</span><span class="p">)</span></code></pre></figure>

<p>
Making dired focus the source file of elisp packages is tad bit
tricker because the file’s name is not fixed. The solution I found
(still borrowing some of Wiesner’s code) was to look for a file whose
name matched the current directory’s name, and if it that doesn’t
exist just focus any <i>“.el”</i> file. This works well for me because my
directory structure typically looks like <i>“~/Git/paradox/paradox.el”</i>.
</p>
<figure class="highlight"><pre><code class="language-cl" data-lang="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">endless/goto-elisp-file</span> <span class="p">()</span>
  <span class="s">"Go to a file with .el extension.
If more than one exists, go to the one with the same name as this
directory. This is enough to catch most package source files."</span>
  <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">files</span> <span class="p">(</span><span class="nv">endless/dired-file-list</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">dirname</span> <span class="p">(</span><span class="nv">file-name-base</span> <span class="p">(</span><span class="nv">directory-file-name</span> <span class="nv">default-directory</span><span class="p">)))</span>
         <span class="p">(</span><span class="nv">target</span> <span class="p">(</span><span class="nv">concat</span> <span class="nv">dirname</span> <span class="s">".el"</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">dired-goto-file</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="nv">target</span><span class="p">))</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">target</span> 
            <span class="p">(</span><span class="nv">car-safe</span> <span class="p">(</span><span class="nv">cl-member-if</span>
                       <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">string-match</span> <span class="s">"\\.el$"</span> <span class="nv">x</span><span class="p">))</span>
                       <span class="nv">files</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">when</span> <span class="nv">target</span> <span class="p">(</span><span class="nv">dired-goto-file</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="nv">target</span><span class="p">))))))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">endless/dired-file-list</span> <span class="p">()</span>
  <span class="s">"List of files in this dired buffer."</span>
  <span class="p">(</span><span class="nv">save-excursion</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">files</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">goto-char</span> <span class="p">(</span><span class="nv">point-min</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nv">eobp</span><span class="p">))</span>
        <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">filename</span> <span class="p">(</span><span class="nv">dired-get-filename</span> <span class="no">nil</span> <span class="ss">'no-error</span><span class="p">)))</span>
          <span class="p">(</span><span class="nb">when</span> <span class="nv">filename</span>
            <span class="p">(</span><span class="nb">push</span> <span class="nv">filename</span> <span class="nv">files</span><span class="p">)))</span>
        <span class="p">(</span><span class="nv">forward-line</span> <span class="mi">1</span><span class="p">))</span>
      <span class="nv">files</span><span class="p">)))</span></code></pre></figure>
</div>
</div>

   <p><a href="http://endlessparentheses.com/auto-focus-a-relevant-file-in-dired-buffers.html?source=rss#disqus_thread">Comment on this.</a></p>